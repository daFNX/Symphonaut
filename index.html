<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Symphonaut - Descubre música personalizada con recomendaciones inteligentes de Spotify">
    <title>Symphonaut - Recomendaciones Musicales Inteligentes</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">
    
    <!-- Vuetify -->
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.6.10/dist/vuetify.min.css" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Poppins', 'Roboto', sans-serif !important;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
        }
        
        .v-application {
            background: transparent !important;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .song-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .song-card:hover {
            transform: translateY(-4px);
        }
        
        .song-card.playing {
            border: 2px solid #4CAF50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.4);
        }
        
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s;
        }
        
        .fade-enter, .fade-leave-to {
            opacity: 0;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .v-app-bar {
            backdrop-filter: blur(20px);
            background: rgba(63, 81, 181, 0.95) !important;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .hover-lift {
            transition: transform 0.2s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div id="app">
        <v-app>
            <!-- App Bar -->
            <v-app-bar app dense dark elevation="0" height="70">
                <v-container class="d-flex align-center pa-0">
                    <div class="d-flex align-center">
                        <v-avatar size="40" class="mr-3">
                            <v-img src="https://cdn.worldvectorlogo.com/logos/spotify-2.svg" contain></v-img>
                        </v-avatar>
                        <div>
                            <div class="text-h5 font-weight-bold" style="letter-spacing: -0.5px;">
                                Symphonaut
                            </div>
                            <div class="caption" style="margin-top: -4px;">Música Inteligente</div>
                        </div>
                    </div>

                    <v-spacer></v-spacer>

                    <v-chip 
                        v-if="user.name" 
                        color="green accent-4" 
                        text-color="white" 
                        class="mr-2"
                        @click="statsVisible = !statsVisible"
                    >
                        <v-avatar left>
                            <v-icon small>mdi-account-circle</v-icon>
                        </v-avatar>
                        {{ user.name }}
                    </v-chip>
                    
                    <v-btn 
                        v-if="isAuthenticated" 
                        icon 
                        @click="logout"
                        title="Cerrar sesión"
                    >
                        <v-icon>mdi-logout</v-icon>
                    </v-btn>
                </v-container>
            </v-app-bar>

            <v-main>
                <v-container class="py-8">
                    <!-- Stats Section -->
                    <transition name="fade">
                        <v-row v-if="statsVisible && recommendations.length > 0" class="mb-6">
                            <v-col cols="12" md="4">
                                <v-card class="stats-card pa-4 text-center" elevation="8">
                                    <v-icon large class="mb-2">mdi-music-note-multiple</v-icon>
                                    <div class="text-h4 font-weight-bold">{{ recommendationsCount }}</div>
                                    <div class="caption">Recomendaciones</div>
                                </v-card>
                            </v-col>
                            <v-col cols="12" md="4">
                                <v-card class="stats-card pa-4 text-center" elevation="8">
                                    <v-icon large class="mb-2">mdi-star</v-icon>
                                    <div class="text-h4 font-weight-bold">{{ averageScore }}%</div>
                                    <div class="caption">Match Promedio</div>
                                </v-card>
                            </v-col>
                            <v-col cols="12" md="4">
                                <v-card class="stats-card pa-4 text-center" elevation="8">
                                    <v-icon large class="mb-2">mdi-playlist-music</v-icon>
                                    <div class="text-h4 font-weight-bold">{{ userProfile.genres.length }}</div>
                                    <div class="caption">Géneros Activos</div>
                                </v-card>
                            </v-col>
                        </v-row>
                    </transition>

                    <v-row justify="center">
                        <v-col cols="12" md="10" lg="8">
                            <!-- Login Card -->
                            <v-card v-if="!isAuthenticated" class="glass-card elevation-12 mb-8 pa-8 text-center" shaped>
                                <v-avatar size="80" class="mb-4">
                                    <v-img src="https://cdn.worldvectorlogo.com/logos/spotify-2.svg" contain></v-img>
                                </v-avatar>
                                
                                <h1 class="text-h4 font-weight-bold mb-3 gradient-text">
                                    Bienvenido a Symphonaut
                                </h1>
                                
                                <p class="text-h6 grey--text mb-6">
                                    Descubre música personalizada con IA
                                </p>
                                
                                <v-card-text class="pb-6">
                                    <v-row>
                                        <v-col cols="12" md="4" class="text-center">
                                            <v-icon large color="purple">mdi-brain</v-icon>
                                            <p class="mt-2">Recomendaciones Inteligentes</p>
                                        </v-col>
                                        <v-col cols="12" md="4" class="text-center">
                                            <v-icon large color="green">mdi-spotify</v-icon>
                                            <p class="mt-2">Integración con Spotify</p>
                                        </v-col>
                                        <v-col cols="12" md="4" class="text-center">
                                            <v-icon large color="blue">mdi-music-note</v-icon>
                                            <p class="mt-2">Personalización Total</p>
                                        </v-col>
                                    </v-row>
                                </v-card-text>
                                
                                <v-btn 
                                    x-large 
                                    color="green accent-4" 
                                    dark 
                                    @click="login" 
                                    elevation="8"
                                    class="px-8"
                                >
                                    <v-icon left>mdi-spotify</v-icon>
                                    Conectar con Spotify
                                </v-btn>
                            </v-card>

                            <!-- Profile Form -->
                            <v-card v-else class="glass-card elevation-12 mb-8" shaped>
                                <v-sheet 
                                    tile 
                                    class="pa-6"
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"
                                >
                                    <div class="d-flex align-center white--text">
                                        <v-icon left large color="white">mdi-tune</v-icon>
                                        <div>
                                            <div class="text-h5 font-weight-bold">Tu Perfil Musical</div>
                                            <div class="caption">Cuéntanos qué te gusta escuchar</div>
                                        </div>
                                    </div>
                                </v-sheet>

                                <v-card-text class="pa-8">
                                    <v-form ref="profileForm">
                                        <!-- Géneros -->
                                        <v-combobox
                                            v-model="userProfile.genres"
                                            :items="availableGenres"
                                            label="Géneros Favoritos"
                                            multiple
                                            chips
                                            deletable-chips
                                            clearable
                                            required
                                            hint="Selecciona al menos un género"
                                            persistent-hint
                                            prepend-icon="mdi-music"
                                        >
                                            <template v-slot:selection="{ attrs, item, select, selected }">
                                                <v-chip
                                                    v-bind="attrs"
                                                    :input-value="selected"
                                                    close
                                                    @click="select"
                                                    @click:close="userProfile.genres = userProfile.genres.filter(g => g !== item)"
                                                    color="purple"
                                                    text-color="white"
                                                    class="ma-1"
                                                >
                                                    {{ item }}
                                                </v-chip>
                                            </template>
                                        </v-combobox>

                                        <!-- Mood -->
                                        <v-select
                                            v-model="userProfile.mood"
                                            :items="moods"
                                            label="¿Cómo te sientes hoy?"
                                            prepend-icon="mdi-emoticon"
                                            class="mt-6"
                                            clearable
                                        >
                                            <template v-slot:item="{ item }">
                                                <v-icon class="mr-3">mdi-emoticon</v-icon>
                                                {{ item }}
                                            </template>
                                        </v-select>

                                        <!-- Energy Slider -->
                                        <div class="mt-8">
                                            <v-slider
                                                v-model="userProfile.energy"
                                                label="Nivel de Energía"
                                                min="0"
                                                max="100"
                                                thumb-label="always"
                                                prepend-icon="mdi-lightning-bolt"
                                                color="amber darken-2"
                                                track-color="grey lighten-2"
                                            >
                                                <template v-slot:thumb-label="{ value }">
                                                    {{ value }}
                                                </template>
                                            </v-slider>
                                            
                                            <div class="d-flex justify-space-between caption grey--text">
                                                <span>😴 Relajado</span>
                                                <span>⚡ Energético</span>
                                            </div>
                                        </div>

                                        <!-- Action Buttons -->
                                        <div class="d-flex mt-8 gap-2">
                                            <v-btn
                                                large
                                                color="purple"
                                                dark
                                                @click="getRecommendations"
                                                :loading="loading"
                                                :disabled="loading || userProfile.genres.length === 0"
                                                class="flex-grow-1"
                                                elevation="4"
                                            >
                                                <v-icon left>mdi-magnify</v-icon>
                                                Buscar Música
                                            </v-btn>
                                            
                                            <v-btn
                                                v-if="recommendations.length > 0"
                                                large
                                                outlined
                                                color="grey"
                                                @click="clearRecommendations"
                                            >
                                                <v-icon>mdi-refresh</v-icon>
                                            </v-btn>
                                        </div>
                                    </v-form>
                                </v-card-text>
                            </v-card>

                            <!-- Alerts -->
                            <transition name="fade">
                                <v-alert 
                                    v-if="alert.show" 
                                    :type="alert.type" 
                                    dense 
                                    dismissible 
                                    v-model="alert.show" 
                                    class="mb-6"
                                    border="left"
                                    colored-border
                                    elevation="2"
                                >
                                    {{ alert.message }}
                                </v-alert>
                            </transition>

                            <!-- Recommendations Grid -->
                            <transition name="fade">
                                <div v-if="recommendations.length > 0">
                                    <div class="d-flex align-center justify-space-between mb-6">
                                        <div>
                                            <h2 class="text-h5 font-weight-bold">
                                                <v-icon color="purple" class="mr-2">mdi-playlist-music</v-icon>
                                                Tus Recomendaciones
                                            </h2>
                                            <p class="caption grey--text">Basadas en tus preferencias musicales</p>
                                        </div>
                                        
                                        <v-chip color="purple" text-color="white">
                                            {{ recommendations.length }} canciones
                                        </v-chip>
                                    </div>

                                    <v-row>
                                        <v-col
                                            v-for="song in recommendations"
                                            :key="song.id"
                                            cols="12" 
                                            sm="6" 
                                            md="6"
                                            lg="4"
                                        >
                                            <song-card 
                                                :song="song" 
                                                @like="likeSong"
                                                @play="playSong"
                                                @share="() => {}"
                                                @more="() => {}"
                                            ></song-card>
                                        </v-col>
                                    </v-row>
                                </div>
                            </transition>

                            <!-- Empty State -->
                            <v-alert
                                v-if="showEmptyState && isAuthenticated && recommendations.length === 0"
                                border="left"
                                colored-border
                                color="purple"
                                elevation="2"
                                class="mt-6 glass-card"
                            >
                                <div class="text-center py-8">
                                    <v-icon size="80" color="purple" class="mb-4 pulse-animation">
                                        mdi-music-note-off
                                    </v-icon>
                                    <h3 class="text-h5 font-weight-bold mb-3">
                                        ¡Empieza tu viaje musical!
                                    </h3>
                                    <p class="text-body-1 grey--text">
                                        Selecciona tus géneros favoritos y descubre música increíble personalizada para ti.
                                    </p>
                                </div>
                            </v-alert>
                        </v-col>
                    </v-row>
                </v-container>
            </v-main>

            <!-- Footer -->
            <v-footer color="transparent" padless>
                <v-col class="text-center py-4" cols="12">
                    <div class="white--text">
                        <strong>Symphonaut</strong> - Sistema de Recomendaciones Musicales
                    </div>
                    <div class="caption white--text mt-1">
                        Powered by Spotify API &copy; {{ new Date().getFullYear() }}
                    </div>
                </v-col>
            </v-footer>
        </v-app>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="src/app.js"></script>
</body>
</html>