<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symphonaut - Recomendaciones Inteligentes</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.6.10/dist/vuetify.min.css" rel="stylesheet">
    <link rel="stylesheet" href="src/styles.css">
</head>
<body>
    <div id="app">
        <v-app>
            <v-app-bar app dense color="indigo darken-4" dark elevation="6">
            <v-toolbar-title class="d-flex align-center">
                <v-avatar size="36" class="mr-3" tile>
                <v-img src="https://cdn.worldvectorlogo.com/logos/spotify-2.svg" contain></v-img>
                </v-avatar>
                <div>
                <div class="headline font-weight-black" style="letter-spacing:.6px">Symphonaut</div>
                <div class="caption">Recomendaciones Inteligentes</div>
                </div>
            </v-toolbar-title>

            <v-spacer></v-spacer>

            <v-chip v-if="user.name" color="green accent-4" text-color="white" class="ma-2">
                <v-avatar left>
                <v-icon>mdi-account-circle</v-icon>
                </v-avatar>
                {{ user.name }}
            </v-chip>
            </v-app-bar>

            <v-main>
            <v-container class="py-8">
                <v-row justify="center">
                <v-col cols="12" md="8" lg="6">
                    <v-card v-if="!isAuthenticated" class="elevation-12 mb-8 pa-8 text-center" shaped>
                    <v-card-title class="justify-center">
                        <v-icon large left color="green accent-4">mdi-spotify</v-icon>
                        Conecta tu cuenta de Spotify
                    </v-card-title>
                    <v-card-text class="pb-6">
                        Para obtener recomendaciones personalizadas y controlar tu música, inicia sesión con Spotify.
                    </v-card-text>
                    <v-card-actions class="justify-center">
                        <v-btn large color="green accent-4" dark @click="login" elevation="8">
                        <v-icon left>mdi-login</v-icon>
                        Iniciar Sesión con Spotify
                        </v-btn>
                    </v-card-actions>
                    </v-card>

                    <v-card v-else class="elevation-12 mb-8" shaped>
                    <v-sheet tile color="indigo darken-4" class="white--text pa-4">
                        <div class="d-flex align-center">
                        <v-icon left>mdi-account-music</v-icon>
                        <div>
                            <div class="subtitle-1 font-weight-bold">Tu Perfil Musical</div>
                            <div class="caption">Perfiles más precisos = mejores recomendaciones</div>
                        </div>
                        </div>
                    </v-sheet>

                    <v-card-text class="pa-6">
                        <v-form ref="profileForm">
                        <v-combobox
                            v-model="userProfile.genres"
                            :items="availableGenres"
                            label="Géneros favoritos"
                            multiple
                            chips
                            deletable-chips
                            clearable
                            required
                        ></v-combobox>

                        <v-select
                            v-model="userProfile.mood"
                            :items="moods"
                            label="¿Cómo te sientes hoy?"
                            prepend-icon="mdi-emoticon"
                            class="mt-4"
                        ></v-select>

                        <v-slider
                            v-model="userProfile.energy"
                            label="Energía preferida"
                            min="0"
                            max="100"
                            thumb-label="always"
                            prepend-icon="mdi-speedometer"
                            class="mt-4"
                        ></v-slider>

                        <v-btn
                          block
                          large
                          color="indigo"
                          dark
                          @click="getRecommendations"
                          :loading="loading"
                          :disabled="loading"
                          class="mt-6"
                          elevation="8"
                        >
                            <v-icon left>mdi-magnify</v-icon>
                            Obtener Recomendaciones
                        </v-btn>
                        </v-form>
                    </v-card-text>
                    </v-card>

                    <v-alert v-if="alert.message" :type="alert.type" dense outlined dismissible v-model="alert.show" class="mb-6">
                    {{ alert.message }}
                    </v-alert>

                    <div v-if="recommendations.length > 0">
                    <v-subheader class="text-h6 font-weight-bold mb-4">
                        <v-icon color="indigo" left>mdi-playlist-music</v-icon>
                        Recomendaciones para ti
                    </v-subheader>

                    <v-row>
                        <v-col
                        v-for="song in recommendations"
                        :key="song.id"
                        cols="12" sm="6" md="6"
                        >
                        <!-- Modern tech/pro song card -->
                        <v-hover v-slot="{ hover }">
                            <v-card :elevation="hover ? 12 : 4" class="rounded-lg" style="overflow: hidden;">
                            <div class="d-flex" style="min-height: 130px;">
                                <v-img
                                :src="song.albumArt || song.image"
                                width="140"
                                aspect-ratio="1"
                                class="grey--text"
                                >
                                <template v-slot:placeholder>
                                    <v-row class="fill-height ma-0" align="center" justify="center">
                                    <v-progress-circular indeterminate color="grey lighten-1"></v-progress-circular>
                                    </v-row>
                                </template>

                                <!-- Play overlay -->
                                <div
                                    class="d-flex align-center justify-center"
                                    style="position: absolute; inset: 0; background: linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.6)); transition: opacity .2s;"
                                    :style="{ opacity: hover ? 1 : 0 }"
                                >
                                    <v-btn icon large color="green accent-4" @click.stop="playSong(song)">
                                    <v-icon x-large>mdi-play-circle</v-icon>
                                    </v-btn>
                                </div>
                                </v-img>

                                <v-card-text class="pa-4" style="flex: 1;">
                                <div class="d-flex justify-space-between">
                                    <div>
                                    <div class="font-weight-bold text-subtitle-1" style="letter-spacing:.2px;">
                                        {{ song.title }}
                                    </div>
                                    <div class="caption grey--text">
                                        {{ (song.artists || []).slice(0,2).join(', ') }}
                                        <span v-if="song.album"> — {{ song.album }}</span>
                                    </div>
                                    </div>

                                    <div class="text-right">
                                    <v-badge color="indigo" content="{{ song.matchPercent ? Math.round(song.matchPercent) + '%' : '' }}" v-if="song.matchPercent">
                                        <template v-slot:badge>
                                        <span class="white--text caption" style="font-weight:600;">{{ Math.round(song.matchPercent) }}%</span>
                                        </template>
                                    </v-badge>
                                    </div>
                                </div>

                                <div class="mt-3">
                                    <v-chip small class="ma-1" color="grey lighten-4" text-color="black" v-for="g in (song.genres || []).slice(0,3)" :key="g">
                                    {{ g }}
                                    </v-chip>
                                </div>

                                <div class="d-flex align-center justify-space-between mt-4">
                                    <div style="width: 58%;">
                                    <div class="caption grey--text">Popularidad</div>
                                    <v-progress-linear :value="(song.popularity || 0)" height="6" color="green accent-4" rounded></v-progress-linear>
                                    </div>

                                    <div class="d-flex flex-column align-end" style="width: 38%;">
                                    <div class="caption grey--text">Energía</div>
                                    <div class="d-flex align-center">
                                        <v-icon small color="amber darken-2" class="mr-1">mdi-flash</v-icon>
                                        <span class="subtitle-2 font-weight-medium">{{ song.energy != null ? song.energy : (userProfile.energy || '—') }}</span>
                                    </div>
                                    </div>
                                </div>
                                </v-card-text>
                            </div>

                            <v-divider-divider></v-

                            <v-card-actions class="pa-3" style="background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0));">
                                <v-btn icon @click="playSong(song)" :title="'Reproducir ' + song.title">
                                <v-icon color="indigo">mdi-play</v-icon>
                                </v-btn>

                                <v-btn icon @click="likeSong(song)" :title="'Me gusta'">
                                <v-icon :color="song.liked ? 'pink' : 'grey'">
                                    {{ song.liked ? 'mdi-heart' : 'mdi-heart-outline' }}
                                </v-icon>
                                </v-btn>

                                <v-btn icon @click="$emit && $emit('add', song)" :title="'Añadir a playlist'">
                                <v-icon color="grey">mdi-playlist-plus</v-icon>
                                </v-btn>

                                <v-spacer></v-spacer>

                                <v-btn small text color="grey" @click="() => {}">
                                <v-icon left small>mdi-dots-horizontal</v-icon>
                                Más
                                </v-btn>
                            </v-card-actions>
                            </v-card>
                        </v-hover>
                        </v-col>
                    </v-row>
                    </div>

                    <v-alert
                    v-if="showEmptyState && isAuthenticated"
                    border="left"
                    colored-border
                    color="indigo lighten-3"
                    elevation="2"
                    class="mt-6"
                    >
                    <div class="text-center">
                        <v-icon large class="mb-2">mdi-music-note-off</v-icon>
                        <h3 class="headline">Completa tu perfil musical</h3>
                        <p>Selecciona tus géneros favoritos y preferencias para que Symphonaut encuentre tu próxima canción favorita.</p>
                    </div>
                    </v-alert>
                </v-col>
                </v-row>
            </v-container>
            </v-main>

            <v-footer color="indigo darken-4" padless dark>
            <v-col class="text-center py-4" cols="12">
                Symphonaut - Sistema Experto Musical &copy; {{ new Date().getFullYear() }}
            </v-col>
            </v-footer>
        </v-app>divider-divider>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script type="module" src="src/app.js"></script>
</body>
</html>